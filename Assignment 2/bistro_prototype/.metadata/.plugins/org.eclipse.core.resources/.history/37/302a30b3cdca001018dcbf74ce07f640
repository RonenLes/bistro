package db;

import java.sql.*;
import java.util.List;
import java.util.ArrayList;
import entities.Reservation;


public class OrderDB {

	private DBManager dbManager;
	
	//SELECT statements
	private static final String SELECT_AllOrders = "SELECT * FROM 'reservations'";
	private static final String SELECT_OrdersByDate = "SELECT * FROM 'reservations' WHERE reservationDate = ?";
	
	public OrderDB() {
		this.dbManager = DBManager.getInstance();
	}
	
	
	/**
	 * method to read all the reservations in the data base and put them in a list for ReservaionControl
	 * @return list of all existing reservations
	 * @throws SQLException
	 */
	public List<Reservation> readAllReservations() throws SQLException{
		
		List<Reservation> reservations = new ArrayList<>();
		
		try {
			Connection conn = dbManager.getConnection();
			Statement stmt = conn.createStatement();
			ResultSet rs = stmt.executeQuery(SELECT_AllOrders);
			
			while(rs.next()) {
				Reservation res = new Reservation(
						rs.getInt("reservationID"),
						rs.getDate("reservationDate"),
						rs.getInt("numberOfGuests"),
						rs.getInt("confirmationCode"),
						rs.getInt("subscriberId"),
						rs.getDate("dateOfPlacingOrder")
				);
				
				reservations.add(res);
			}
		}catch(SQLException e) {
			System.err.println("Database error: could not fetch orders");
			throw e;
		}
		return reservations;
	}
	
	/**
	 * 
	 * @param date of the desired reservation
	 * @return list of reservation of the desired date
	 * @throws SQLException
	 */
	public List<Reservations> readReservationsByDate(Date date) throws SQLException{
		
		List<Reservation> reservations = new ArrayList<>();
		
		try {
			
			Connection conn = dbManager.getConnection();
			PreparedStatement pstmt = conn.prepareStatement(SELECT_OrdersByDate);
			pstmt.setDate(1, date);
			ResultSet rs = pstmt.executeQuery();
			
			while(rs.next()) {
				Reservation res = new Reservation(
						rs.getInt("reservationID"),
						rs.getDate("reservationDate"),
						rs.getInt("numberOfGuests"),
						rs.getInt("confirmationCode"),
						rs.getInt("subscriberId"),
						rs.getDate("dateOfPlacingOrder")
				);
			}
			
			
		}
	}
	
}
