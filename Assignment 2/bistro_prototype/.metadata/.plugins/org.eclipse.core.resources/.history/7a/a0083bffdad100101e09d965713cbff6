package application;

import java.io.FileInputStream;
import java.io.InputStream;
import java.util.Properties;

import controllers.ClientController;

public class ClientMain {

    public static void main(String[] args) {

    	boolean connected = false;
        String host = "localhost";   // default host
        int port = 3000;             // default port

        Properties props = new Properties();
        boolean loaded = false;

        try {
        	//try reading host from external file
            try (InputStream external = new FileInputStream("dbDetails.properties")) {
                props.load(external);
                System.out.println("Loaded EXTERNAL details file.");
                loaded = true;
            } catch (Exception e) {
                System.out.println("External file not found. Trying INTERNAL file...");
            }

            if (!loaded) {
                try (InputStream internal = ClientMain.class.getClassLoader()
                        .getResourceAsStream("dbDetailsLaptop.properties")) {

                    if (internal != null) {
                        props.load(internal);
                        System.out.println("Loaded INTERNAL details file.");
                        loaded = true;
                    }
                }
            }

            if (!loaded) {
                System.err.println("No details file found. Using defaults.");
            }

            String propHost = props.getProperty("hostIP");
            if (propHost != null && !propHost.isBlank()) {
                host = propHost.trim();
            }

            System.out.println("Using host: " + host);

        } catch (Exception e) {
            System.err.println("Failed loading details: " + e.getMessage());
        }

        //initialize client and client controller
        BistroClient client = new BistroClient(host, port);
        ClientController controller = new ClientController(client);
        client.setClientController(controller);

        try {
            client.openConnection();
            connected = true;
            System.out.println("Connected to server on " + host + ":" + port);
        } catch (Exception e) {
            System.out.println("Connection failed: " + e.getMessage());
        }

        ClientUI.startUI(controller, connected);
    }
}
